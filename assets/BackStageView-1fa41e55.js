import{_ as f,o as i,c as n,a as t,t as h,M as D,b as y,w as r,v as m,F as v,r as k,d as M,e as _,f as b}from"./index-e6ab977c.js";const P={data(){return{uploadImages:""}},methods:{upload(o){const e=o.target.files[0];let a=e.name.substring(e.name.lastIndexOf(".")+1);if(a!=="jpg"&&a!=="JPG"&&a!=="png"){alert("上傳檔案只能是 jpg、png 格式!，請注意格式上傳呦");return}const c=new FormData;c.append("file-to-upload",e);const d="https://vue3-course-api.hexschool.io/v2",l="week3dean";this.$http.post(`${d}/api/${l}/admin/upload`,c).then(s=>{this.uploadImages=s.data.imageUrl,alert("圖片上傳成功")}).catch(s=>{alert(s.response.data.message)})}}},x={class:"container mt-4"},$=t("h2",null,"圖片上傳區",-1),C=t("label",{for:"file",class:"mb-2"},"圖片檔案僅接受 jpg、png 格式，感謝配合～",-1),V=["href"],N={class:"break-word"};function I(o,e,a,c,d,l){return i(),n("div",x,[$,C,t("input",{type:"file",class:"form-control mb-2",id:"file",placeholder:"請輸入圖片連結",onChange:e[0]||(e[0]=(...s)=>l.upload&&l.upload(...s))},null,32),t("a",{href:d.uploadImages,target:"_blank"},"上傳的圖片連結",8,V),t("p",N,h(d.uploadImages),1)])}const L=f(P,[["render",I]]),T={props:["tempData"],data(){return{deleteProductModal:""}},methods:{deleteProduct(){const o="https://vue3-course-api.hexschool.io/v2",e="week3dean";this.$http.delete(`${o}/api/${e}/admin/product/${this.tempData.id}`).then(a=>{alert(a.data.message),this.deleteProductModal.hide(),this.$emit("update")}).catch(a=>{alert(a.response.data.message)})},show(){this.deleteProductModal.show()},hide(){this.deleteProductModal.hide()}},mounted(){this.deleteProductModal=new D(this.$refs.deleteProductModal)}},A={id:"deleteProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"deleteProductModalLabel","aria-hidden":"true",ref:"deleteProductModal"},B={class:"modal-dialog"},j={class:"modal-content border-0"},E=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"deleteProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},S={class:"text-danger"},z={class:"modal-footer"},G=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function H(o,e,a,c,d,l){return i(),n("div",A,[t("div",B,[t("div",j,[E,t("div",F,[y(" 是否刪除 "),t("strong",S,h(a.tempData.title),1),y(" 商品(刪除後將無法恢復)。 ")]),t("div",z,[G,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...s)=>l.deleteProduct&&l.deleteProduct(...s))}," 確認刪除 ")])])])],512)}const J=f(T,[["render",H]]),K={props:["tempData","isNew"],data(){return{editProductModal:""}},methods:{confirm(){const o="https://vue3-course-api.hexschool.io/v2",e="week3dean";let a="post",c=`${o}/api/${e}/admin/product`;this.isNew===!1&&(a="put",c=`${o}/api/${e}/admin/product/${this.tempData.id}`),this.$http[a](c,{data:this.tempData}).then(d=>{alert(d.data.message),this.editProductModal.hide(),this.$emit("update")}).catch(d=>{alert(d.response.data.message)})},createImage(){this.tempData.imagesUrl=[],this.tempData.imagesUrl.push("")},show(){this.editProductModal.show()},hide(){this.editProductModal.hide()}},mounted(){this.editProductModal=new D(this.$refs.editProductModal)}},O={id:"editProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editProductModalLabel","aria-hidden":"true",ref:"editProductModal"},W={class:"modal-dialog modal-xl"},q={class:"modal-content border-0"},Q={class:"modal-header bg-dark text-white"},R={id:"editProductModalLabel",class:"modal-title"},X={key:0},Y={key:1},Z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),tt={class:"modal-body"},et={class:"row"},at={class:"col-sm-4"},st={class:"mb-3"},ot=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),lt=["src"],dt=t("h3",{class:"mb-3"},"次要圖片",-1),it={key:0},nt={class:"mb-3"},ct=t("label",{for:"imageUrl"}," 圖片網址",-1),rt=["onUpdate:modelValue"],mt=["src"],ut={key:0},ht={key:1},pt={key:1},_t={class:"col-sm-8"},bt={class:"mb-3"},ft=t("label",{for:"title",class:"form-label"},"標題",-1),gt={class:"row"},vt={class:"mb-3 col-md-6"},yt=t("label",{for:"category",class:"form-label"},"分類",-1),Dt={class:"mb-3 col-md-6"},kt=t("label",{for:"price",class:"form-label"},"單位",-1),wt={class:"row"},Ut={class:"mb-3 col-md-6"},Mt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Pt={class:"mb-3 col-md-6"},xt=t("label",{for:"price",class:"form-label"},"售價",-1),$t=t("hr",null,null,-1),Ct={class:"row"},Vt={class:"mb-3 col-md-12"},Nt=t("label",{for:"flavor",class:"form-label"},"口味",-1),It={class:"mb-3"},Lt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Tt={class:"mb-3"},At=t("label",{for:"content",class:"form-label"},"說明內容",-1),Bt={class:"mb-3"},jt={class:"form-check"},Et={class:"form-check-label",for:"is_enabled"},Ft={class:"modal-footer"};function St(o,e,a,c,d,l){return i(),n("div",O,[t("div",W,[t("div",q,[t("div",Q,[t("h5",R,[a.isNew?(i(),n("span",X,"新增產品")):(i(),n("span",Y,"編輯產品"))]),Z]),t("div",tt,[t("div",et,[t("div",at,[t("div",st,[ot,r(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.tempData.imageUrl=s),type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,512),[[m,a.tempData.imageUrl]]),t("img",{class:"img-fluid",src:a.tempData.imageUrl},null,8,lt)]),dt,Array.isArray(a.tempData.imagesUrl)?(i(),n("div",it,[(i(!0),n(v,null,k(a.tempData.imagesUrl,(s,p)=>(i(),n("div",{class:"mb-1",key:p},[t("div",nt,[ct,r(t("input",{type:"text","onUpdate:modelValue":g=>a.tempData.imagesUrl[p]=g,class:"form-control",placeholder:"請輸入圖片連結"},null,8,rt),[[m,a.tempData.imagesUrl[p]]])]),t("img",{class:"img-fluid",src:s,alt:""},null,8,mt)]))),128)),a.tempData.imagesUrl.length==0||a.tempData.imagesUrl[a.tempData.imagesUrl.length-1]?(i(),n("div",ut,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=s=>a.tempData.imagesUrl.push(""))}," 新增圖片2 ")])):(i(),n("div",ht,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>a.tempData.imagesUrl.pop())}," 刪除圖片 ")]))])):(i(),n("div",pt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[3]||(e[3]=(...s)=>l.createImage&&l.createImage(...s))}," 新增圖片1 ")]))]),t("div",_t,[t("div",bt,[ft,r(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[4]||(e[4]=s=>a.tempData.title=s)},null,512),[[m,a.tempData.title]])]),t("div",gt,[t("div",vt,[yt,r(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[5]||(e[5]=s=>a.tempData.category=s)},null,512),[[m,a.tempData.category]])]),t("div",Dt,[kt,r(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[6]||(e[6]=s=>a.tempData.unit=s)},null,512),[[m,a.tempData.unit]])])]),t("div",wt,[t("div",Ut,[Mt,r(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[7]||(e[7]=s=>a.tempData.origin_price=s)},null,512),[[m,a.tempData.origin_price,void 0,{number:!0}]])]),t("div",Pt,[xt,r(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[8]||(e[8]=s=>a.tempData.price=s)},null,512),[[m,a.tempData.price,void 0,{number:!0}]])])]),$t,t("div",Ct,[t("div",Vt,[Nt,r(t("input",{id:"flavor",type:"text",class:"form-control",placeholder:"請輸入口味","onUpdate:modelValue":e[9]||(e[9]=s=>a.tempData.flavor=s)},null,512),[[m,a.tempData.flavor,void 0,{number:!0}]])])]),t("div",It,[Lt,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=s=>a.tempData.description=s)},`
                `,512),[[m,a.tempData.description]])]),t("div",Tt,[At,r(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=s=>a.tempData.content=s)},`
                `,512),[[m,a.tempData.content]])]),t("div",Bt,[t("div",jt,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=s=>a.tempData.is_enabled=s),"true-value":1,"false-value":0},null,512),[[M,a.tempData.is_enabled]]),t("label",Et,h(a.tempData.is_enabled?"啟用":"不啟用"),1)])])])])]),t("div",Ft,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[13]||(e[13]=(...s)=>l.hide&&l.hide(...s))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=(...s)=>l.confirm&&l.confirm(...s))}," 確認 ")])])])],512)}const zt=f(K,[["render",St]]),Gt={data(){return{products:[],page:{},isNew:!1,tempData:{imagesUrl:[],flavor:""}}},methods:{checkAdmin(){const o="https://vue3-course-api.hexschool.io/v2";this.$http.post(`${o}/api/user/check`).then(e=>{console.log(e.data),this.getProductList()}).catch(e=>{console.log(e.message),alert("請先登入帳號密碼喔～不要偷懶(ゝ∀･)b 感謝你！"),this.$router.back()})},getProductList(o=1){const e="https://vue3-course-api.hexschool.io/v2",a="week3dean";this.$http.get(`${e}/api/${a}/admin/products/?page=${o}`).then(c=>{this.page=c.data.pagination,this.products=c.data.products}).catch(c=>{alert(c.response.data.message)})},openModal(o,e){o==="new"?(this.tempData={imagesUrl:[]},this.$refs.editProductModal.show(),this.isNew=!0):o==="edit"?(this.$refs.editProductModal.show(),this.tempData={...e},this.isNew=!1):o==="delete"&&(this.$refs.deleteProductModal.show(),this.tempData={...e},this.isNew=!1)}},components:{ProductModal:zt,DeleteModal:J,UploadImages:L},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)week2HexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=o,this.checkAdmin()}},Ht=t("h1",{class:"text-center"},"WEEK4後台1 | Backstage",-1),Jt={class:"container"},Kt={class:"text-end mt-4"},Ot={class:"table mt-4"},Wt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),qt={key:0,class:"text-success"},Qt={key:1},Rt={class:"btn-group"},Xt=["onClick"],Yt=["onClick"];function Zt(o,e,a,c,d,l){const s=_("Upload-Images"),p=_("pagination"),g=_("ProductModal"),w=_("delete-modal");return i(),n(v,null,[Ht,b(s),t("div",Jt,[t("div",Kt,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=u=>l.openModal("new",o.product))}," 建立新產品 ")]),t("table",Ot,[Wt,t("tbody",null,[(i(!0),n(v,null,k(d.products,u=>(i(),n("tr",{key:u.id},[t("td",null,h(u.category),1),t("td",null,h(u.title),1),t("td",null,"NT$"+h(u.origin_price),1),t("td",null,"NT$"+h(u.price),1),t("td",null,[u.is_enabled?(i(),n("span",qt,"啟用")):(i(),n("span",Qt,"未啟用"))]),t("td",null,[t("div",Rt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:U=>l.openModal("edit",u)}," 編輯 ",8,Xt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:U=>l.openModal("delete",u)}," 刪除 ",8,Yt)])])]))),128))])]),b(p,{"page-in":d.page,"get-product-list":l.getProductList},null,8,["page-in","get-product-list"])]),b(g,{"temp-data":d.tempData,onUpdate:l.getProductList,"is-new":d.isNew,ref:"editProductModal"},null,8,["temp-data","onUpdate","is-new"]),b(w,{"temp-data":d.tempData,onUpdate:l.getProductList,ref:"deleteProductModal"},null,8,["temp-data","onUpdate"])],64)}const ee=f(Gt,[["render",Zt]]);export{ee as default};
