import{_,o as i,c as d,a as t,t as u,M,b as x,w as c,v as p,F as f,r as P,d as C,n as D,e as k,f as b,g}from"./index-bbbacb23.js";const I={data(){return{uploadImages:""}},methods:{upload(l){const e=l.target.files[0];let a=e.name.substring(e.name.lastIndexOf(".")+1);if(a!=="jpg"&&a!=="JPG"&&a!=="png"){alert("上傳檔案只能是 jpg、png 格式!，請注意格式上傳呦");return}const r=new FormData;r.append("file-to-upload",e);const o="https://vue3-course-api.hexschool.io/v2",n="week3dean";this.$http.post(`${o}/api/${n}/admin/upload`,r).then(s=>{this.uploadImages=s.data.imageUrl,alert("圖片上傳成功")}).catch(s=>{alert(s.response.data.message)})}}},N={class:"container mt-4"},V=t("h2",null,"圖片上傳區",-1),L=t("label",{for:"file",class:"mb-2"},"圖片檔案僅接受 jpg、png 格式，感謝配合～",-1),T=["href"],A={class:"break-word"};function B(l,e,a,r,o,n){return i(),d("div",N,[V,L,t("input",{type:"file",class:"form-control mb-2",id:"file",placeholder:"請輸入圖片連結",onChange:e[0]||(e[0]=(...s)=>n.upload&&n.upload(...s))},null,32),t("a",{href:o.uploadImages,target:"_blank"},"上傳的圖片連結",8,T),t("p",A,u(o.uploadImages),1)])}const S=_(I,[["render",B]]),y="https://vue3-course-api.hexschool.io/v2",w="week3dean",j={props:["tempData"],data(){return{deleteProductModal:""}},methods:{deleteProduct(){this.$http.delete(`${y}/api/${w}/admin/product/${this.tempData.id}`).then(l=>{alert(l.data.message),this.deleteProductModal.hide(),this.$emit("update")}).catch(l=>{alert(l.response.data.message)})},show(){this.deleteProductModal.show()},hide(){this.deleteProductModal.hide()}},mounted(){this.deleteProductModal=new M(this.$refs.deleteProductModal)}},E={id:"deleteProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"deleteProductModalLabel","aria-hidden":"true",ref:"deleteProductModal"},F={class:"modal-dialog"},J={class:"modal-content border-0"},O=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"deleteProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),z={class:"modal-body"},G={class:"text-danger"},H={class:"modal-footer"},K=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function W(l,e,a,r,o,n){return i(),d("div",E,[t("div",F,[t("div",J,[O,t("div",z,[x(" 是否刪除 "),t("strong",G,u(a.tempData.title),1),x(" 商品(刪除後將無法恢復)。 ")]),t("div",H,[K,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...s)=>n.deleteProduct&&n.deleteProduct(...s))}," 確認刪除 ")])])])],512)}const q=_(j,[["render",W]]),Q={props:["isNew","innerTempData"],data(){return{tempData:JSON.parse(JSON.stringify(this.innerTempData)),editProductModal:""}},methods:{confirm(){let l="post",e=`${y}/api/${w}/admin/product`;this.isNew===!1&&(l="put",e=`${y}/api/${w}/admin/product/${this.tempData.id}`),this.$http[l](e,{data:this.tempData}).then(a=>{alert(a.data.message),this.editProductModal.hide(),this.$emit("update")}).catch(a=>{alert(a.response.data.message)})},createImage(){this.tempData.imagesUrl=[],this.tempData.imagesUrl.push("")},show(){this.editProductModal.show()},hide(){this.editProductModal.hide()}},watch:{innerTempData(){this.tempData=this.innerTempData}},mounted(){this.editProductModal=new M(this.$refs.editProductModal),console.log(this.tempData)}},R={id:"editProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"editProductModalLabel","aria-hidden":"true",ref:"editProductModal"},X={class:"modal-dialog modal-xl"},Y={class:"modal-content border-0"},Z={class:"modal-header bg-dark text-white"},tt={id:"editProductModalLabel",class:"modal-title"},et={key:0},st={key:1},ot=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),at={class:"modal-body"},lt={class:"row"},nt={class:"col-sm-4"},it={class:"mb-3"},dt=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),rt=["src"],ct=t("h3",{class:"mb-3"},"次要圖片",-1),pt={key:0},mt={class:"mb-3"},ut=t("label",{for:"imageUrl"}," 圖片網址",-1),ht=["onUpdate:modelValue"],_t=["src"],bt={key:0},gt={key:1},ft={key:1},vt={class:"col-sm-8"},Dt={class:"mb-3"},kt=t("label",{for:"title",class:"form-label"},"標題",-1),yt={class:"row"},wt={class:"mb-3 col-md-6"},Pt=t("label",{for:"category",class:"form-label"},"分類",-1),xt={class:"mb-3 col-md-6"},Mt=t("label",{for:"price",class:"form-label"},"單位",-1),Ut={class:"row"},$t={class:"mb-3 col-md-6"},Ct=t("label",{for:"origin_price",class:"form-label"},"原價",-1),It={class:"mb-3 col-md-6"},Nt=t("label",{for:"price",class:"form-label"},"售價",-1),Vt=t("hr",null,null,-1),Lt={class:"row"},Tt={class:"mb-3 col-md-12"},At=t("label",{for:"flavor",class:"form-label"},"口味",-1),Bt={class:"mb-3"},St=t("label",{for:"description",class:"form-label"},"產品描述",-1),jt={class:"mb-3"},Et=t("label",{for:"content",class:"form-label"},"說明內容",-1),Ft={class:"mb-3"},Jt={class:"form-check"},Ot={class:"form-check-label",for:"is_enabled"},zt={class:"modal-footer"};function Gt(l,e,a,r,o,n){return i(),d("div",R,[t("div",X,[t("div",Y,[t("div",Z,[t("h5",tt,[a.isNew?(i(),d("span",et,"新增產品")):(i(),d("span",st,"編輯產品"))]),ot]),t("div",at,[t("div",lt,[t("div",nt,[t("div",it,[dt,c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.tempData.imageUrl=s),type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,512),[[p,o.tempData.imageUrl]]),t("img",{class:"img-fluid",src:o.tempData.imageUrl},null,8,rt)]),ct,Array.isArray(o.tempData.imagesUrl)?(i(),d("div",pt,[(i(!0),d(f,null,P(o.tempData.imagesUrl,(s,h)=>(i(),d("div",{class:"mb-1",key:h},[t("div",mt,[ut,c(t("input",{type:"text","onUpdate:modelValue":v=>o.tempData.imagesUrl[h]=v,class:"form-control",placeholder:"請輸入圖片連結"},null,8,ht),[[p,o.tempData.imagesUrl[h]]])]),t("img",{class:"img-fluid",src:s,alt:""},null,8,_t)]))),128)),o.tempData.imagesUrl.length==0||o.tempData.imagesUrl[o.tempData.imagesUrl.length-1]?(i(),d("div",bt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=s=>o.tempData.imagesUrl.push(""))}," 新增圖片2 ")])):(i(),d("div",gt,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>o.tempData.imagesUrl.pop())}," 刪除圖片 ")]))])):(i(),d("div",ft,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[3]||(e[3]=(...s)=>n.createImage&&n.createImage(...s))}," 新增圖片1 ")]))]),t("div",vt,[t("div",Dt,[kt,c(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[4]||(e[4]=s=>o.tempData.title=s)},null,512),[[p,o.tempData.title]])]),t("div",yt,[t("div",wt,[Pt,c(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[5]||(e[5]=s=>o.tempData.category=s)},null,512),[[p,o.tempData.category]])]),t("div",xt,[Mt,c(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[6]||(e[6]=s=>o.tempData.unit=s)},null,512),[[p,o.tempData.unit]])])]),t("div",Ut,[t("div",$t,[Ct,c(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[7]||(e[7]=s=>o.tempData.origin_price=s)},null,512),[[p,o.tempData.origin_price,void 0,{number:!0}]])]),t("div",It,[Nt,c(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[8]||(e[8]=s=>o.tempData.price=s)},null,512),[[p,o.tempData.price,void 0,{number:!0}]])])]),Vt,t("div",Lt,[t("div",Tt,[At,c(t("input",{id:"flavor",type:"text",class:"form-control",placeholder:"請輸入口味","onUpdate:modelValue":e[9]||(e[9]=s=>o.tempData.flavor=s)},null,512),[[p,o.tempData.flavor,void 0,{number:!0}]])])]),t("div",Bt,[St,c(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=s=>o.tempData.description=s)},`
                `,512),[[p,o.tempData.description]])]),t("div",jt,[Et,c(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=s=>o.tempData.content=s)},`
                `,512),[[p,o.tempData.content]])]),t("div",Ft,[t("div",Jt,[c(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=s=>o.tempData.is_enabled=s),"true-value":1,"false-value":0},null,512),[[C,o.tempData.is_enabled]]),t("label",Ot,u(o.tempData.is_enabled?"啟用":"不啟用"),1)])])])])]),t("div",zt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[13]||(e[13]=(...s)=>n.hide&&n.hide(...s))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=(...s)=>n.confirm&&n.confirm(...s))}," 確認 ")])])])],512)}const Ht=_(Q,[["render",Gt]]),Kt={props:["pageIn","getProductList"]},Wt={"aria-label":"Page navigation example"},qt={class:"pagination"},Qt=t("span",{"aria-hidden":"true"},"«",-1),Rt=[Qt],Xt=["onClick"],Yt=t("span",{"aria-hidden":"true"},"»",-1),Zt=[Yt];function te(l,e,a,r,o,n){return i(),d("nav",Wt,[t("ul",qt,[t("li",{class:D(["page-item",{disabled:a.pageIn.has_pre===!1}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=k(s=>a.getProductList(a.pageIn.current_page-1),["prevent"]))},Rt)],2),(i(!0),d(f,null,P(a.pageIn.total_pages,s=>(i(),d("li",{class:D(["page-item",{active:s===a.pageIn.current_page}]),key:s+"pages"},[t("a",{class:"page-link",href:"#",onClick:k(h=>a.getProductList(s),["prevent"])},u(s),9,Xt)],2))),128)),t("li",{class:D(["page-item",{disabled:!a.pageIn.has_next}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=k(s=>a.getProductList(a.pageIn.current_page+1),["prevent"]))},Zt)],2)])])}const ee=_(Kt,[["render",te]]),se={data(){return{products:[],page:{},isNew:!1,tempData:{imagesUrl:[],flavor:"",is_enabled:1}}},methods:{checkAdmin(){const l="https://vue3-course-api.hexschool.io/v2";this.$http.post(`${l}/api/user/check`).then(e=>{console.log(e.data),this.getProductList()}).catch(e=>{console.log(e.message),alert("請先登入帳號密碼喔～不要偷懶(ゝ∀･)b 感謝你！"),this.$router.back()})},getProductList(l=1){const e="https://vue3-course-api.hexschool.io/v2",a="week3dean";this.$http.get(`${e}/api/${a}/admin/products/?page=${l}`).then(r=>{this.page=r.data.pagination,this.products=r.data.products}).catch(r=>{alert(r.response.data.message)})},openModal(l,e){l==="new"?(this.tempData={imagesUrl:[],is_enabled:1},this.$refs.editProductModal.show(),console.log(this.tempData),this.isNew=!0):l==="edit"?(this.$refs.editProductModal.show(),this.tempData={...e},console.log(this.tempData),this.isNew=!1):l==="delete"&&(this.$refs.deleteProductModal.show(),this.tempData={...e},this.isNew=!1)}},components:{ProductModal:Ht,DeleteModal:q,PaginationComponent:ee,UploadImages:S},mounted(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)week2HexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l,this.checkAdmin()}},oe=t("h1",{class:"text-center"},"WEEK4後台1 | Backstage",-1),ae={class:"container"},le={class:"text-end mt-4"},ne={class:"table mt-4"},ie=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),de={key:0,class:"text-success"},re={key:1},ce={class:"btn-group"},pe=["onClick"],me=["onClick"];function ue(l,e,a,r,o,n){const s=b("Upload-Images"),h=b("PaginationComponent"),v=b("ProductModal"),U=b("delete-modal");return i(),d(f,null,[oe,g(s),t("div",ae,[t("div",le,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=m=>n.openModal("new",l.product))}," 建立新產品 ")]),t("table",ne,[ie,t("tbody",null,[(i(!0),d(f,null,P(o.products,m=>(i(),d("tr",{key:m.id},[t("td",null,u(m.category),1),t("td",null,u(m.title),1),t("td",null,"NT$"+u(m.origin_price),1),t("td",null,"NT$"+u(m.price),1),t("td",null,[m.is_enabled?(i(),d("span",de,"啟用")):(i(),d("span",re,"未啟用"))]),t("td",null,[t("div",ce,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:$=>n.openModal("edit",m)}," 編輯 ",8,pe),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:$=>n.openModal("delete",m)}," 刪除 ",8,me)])])]))),128))])]),g(h,{"page-in":o.page,"get-product-list":n.getProductList},null,8,["page-in","get-product-list"])]),g(v,{"inner-temp-data":o.tempData,onUpdate:n.getProductList,"is-new":o.isNew,ref:"editProductModal"},null,8,["inner-temp-data","onUpdate","is-new"]),g(U,{"temp-data":o.tempData,onUpdate:n.getProductList,ref:"deleteProductModal"},null,8,["temp-data","onUpdate"])],64)}const _e=_(se,[["render",ue]]);export{_e as default};
